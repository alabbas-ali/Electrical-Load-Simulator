<!DOCTYPE HTML>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org">
<head
	th:replace="layout/main :: head(title='HIS-LPS::Simulation Result')"></head>
<body class="skin-blue layout-top-nav layout-boxed">

	<div class="wrapper">
		<div th:replace="layout/main :: header('simulation')"></div>

		<!-- Full Width Column -->
		<div class="content-wrapper">

			<!-- Content Header (Page header) -->
			<section class="content-header"
				th:insert="layout/main :: breadcrumb(~{ :: .breadcrumb})">
				<ol class="breadcrumb">
					<li><a href="/"><i class="fa fa-dashboard"></i>Home</a></li>
					<li><a href="/simulation">Simulation</a></li>
					<li class="active">Result</li>
				</ol>
			</section>


			<!-- Main content -->
			<section class="content">

				<div class="row">
					<div class="col-lg-3 col-xs-6">
						<!-- small box -->
						<div class="small-box bg-aqua">
							<div class="inner">
								<h3 th:text="${#dates.format(simConfig.date, 'dd/MM/yy')}"></h3>
								<p
									th:text="${#dates.format(simConfig.date, ' HH:mm') + ' oclock'}"></p>
								<p>Run Date</p>
							</div>
							<div class="icon">
								<i class="fa fa-calendar"></i>
							</div>
						</div>
					</div>
					<!-- ./col -->
					<div class="col-lg-3 col-xs-6">
						<!-- small box -->
						<div class="small-box bg-green">
							<div class="inner">
								<h3>
									<span th:text="${simConfig.singlesPercentage}"></span> <sup
										style="font-size: 20px"> %</sup>
								</h3>
								<p>&nbsp;</p>
								<p>Singles Percentage</p>
							</div>
							<div class="icon">
								<i class="ion ion-pie-graph"></i>
							</div>
						</div>
					</div>
					<!-- ./col -->
					<div class="col-lg-3 col-xs-6">
						<!-- small box -->
						<div class="small-box bg-yellow">
							<div class="inner">
								<h3 th:text="${simConfig.numberOfHouses}"></h3>
								<p>&nbsp;</p>
								<p># Houses</p>
							</div>
							<div class="icon">
								<i class="fa fa-home"></i>
							</div>
						</div>
					</div>
					<!-- ./col -->
					<div class="col-lg-3 col-xs-6">
						<!-- small box -->
						<div class="small-box bg-red">
							<div class="inner">
								<h3># People</h3>
								<p th:text="'Minimum ' + ${simConfig.minNumberOfPeople}"></p>
								<p th:text="'Minimum ' + ${simConfig.maxNumberOfPeople}"></p>
							</div>
							<div class="icon">
								<i class="ion ion-pie-graph"></i>
							</div>
						</div>
					</div>
					<!-- ./col -->
				</div>

				<div class="row">
					<div class="col-md-12">
						<div class="box box-primary">
							<div class="box-header with-border">
								<h3 class="box-title">
									Simulation <span th:text="${simConfig.name}"></span> Result
								</h3>
								<div class="box-tools pull-right">
									<button type="button" class="btn btn-box-tool"
										data-widget="collapse">
										<i class="fa fa-minus"></i>
									</button>
									<button type="button" class="btn btn-box-tool"
										data-widget="remove">
										<i class="fa fa-times"></i>
									</button>
								</div>
							</div>

							<div class="box-body">
								<div class="chart">
									<canvas id="total-chart" width="510" height="250"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>

				<div class="row"  th:each="house : ${houses}">
					<div class="col-md-12">
						<div class="box box-info">
							<div class="box-header with-border">
								<h3 class="box-title" th:text="${house.type}"></h3>

								<div class="box-tools pull-right">
									<button type="button" class="btn btn-box-tool"
										data-widget="collapse">
										<i class="fa fa-minus"></i>
									</button>
									<button type="button" class="btn btn-box-tool"
										data-widget="remove">
										<i class="fa fa-times"></i>
									</button>
								</div>
							</div>
							<div class="box-body">
								<div class="chart">
									<canvas id="line-chart"
									th:id="'line-chart-' + ${house.id}" width="510" height="250"></canvas>
								</div>
							</div>
							<!-- /.box-body -->
						</div>
					</div>
				</div>


			</section>
			<!-- end container -->
		</div>


		<!-- Main Footer -->
		<div th:replace="layout/main :: footer"></div>

	</div>

	<!-- Morris.js charts -->
	<script type="text/javascript" src="../../../js/chart/dist/Chart.min.js"
		th:src="@{/js/chart/dist/Chart.min.js}"></script>

	<!-- FastClick -->
	<script type="text/javascript"
		src="../../../js/fastclick/lib/fastclick.js"
		th:src="@{/js/fastclick/lib/fastclick.js}"></script>


	<script type="text/javascript" th:inline="javascript">
		/*<![CDATA[*/

		String.prototype.toHHMMSS = function() {
			var sec_num = parseInt(this, 10); // don't forget the second param
			var hours = Math.floor(sec_num / 3600);
			var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
			var seconds = sec_num - (hours * 3600) - (minutes * 60);

			if (hours < 10) {
				hours = "0" + hours;
			}
			if (minutes < 10) {
				minutes = "0" + minutes;
			}
			if (seconds < 10) {
				seconds = "0" + seconds;
			}
			return hours + ':' + minutes + ':' + seconds;
		}
		
		
		
		var areaChartOptions = {
			//Boolean - If we should show the scale at all
			showScale : true,
			//Boolean - Whether grid lines are shown across the chart
			scaleShowGridLines : false,
			//String - Colour of the grid lines
			scaleGridLineColor : 'rgba(3, 2, 2, 0.73)',
			//Number - Width of the grid lines
			scaleGridLineWidth : 2,
			//Boolean - Whether to show horizontal lines (except X axis)
			scaleShowHorizontalLines : true,
			//Boolean - Whether to show vertical lines (except Y axis)
			scaleShowVerticalLines : false,
			//Boolean - Whether the line is curved between points
			bezierCurve : true,
			//Number - Tension of the bezier curve between points
			bezierCurveTension : 0.3,
			//Boolean - Whether to show a dot for each point
			pointDot : true,
			//Number - Radius of each point dot in pixels
			pointDotRadius : 5,
			//Number - Pixel width of point dot stroke
			pointDotStrokeWidth : 1,
			//Number - amount extra to add to the radius to cater for hit detection outside the drawn point
			pointHitDetectionRadius : 20,
			//Boolean - Whether to show a stroke for datasets
			datasetStroke : false,
			//Number - Pixel width of dataset stroke
			datasetStrokeWidth : 2,
			//Boolean - Whether to fill the dataset with a color
			datasetFill : false,
			//String - A legend template
			legendTemplate : '<ul class="<%=name.toLowerCase()%>-legend"><% for (var i=0; i<datasets.length; i++){%><li><span style="background-color:<%=datasets[i].lineColor%>"></span><%if(datasets[i].label){%><%=datasets[i].label%><%}%></li><%}%></ul>',
			//Boolean - whether to maintain the starting aspect ratio or not when responsive, if set to false, will take up entire container
			maintainAspectRatio : true,
			//Boolean - whether to make the chart responsive to window resizing
			responsive : true
		};
		

		$(document).ready(
				function() {
					var lines = [];

					/*[# th:each="house : ${houses}"]*/
					var houseid = "[(${house.id})]";
					var labels = [];
					var loaddata = [];
					var lightingdata = [];
					var tot = 0;
					var tot2 = 0;

					/*[# th:each="measurement : ${house.resultLoadCurve.measurements}"]*/
						labels.push('[(${measurement.time})]'.toHHMMSS());
						loaddata.push('[(${measurement.value})]');
						tot = tot + parseInt('[(${measurement.value})]');
						lightingdata.push('[(${measurement.lightingValue})]');
						tot2 = tot2 + parseInt('[(${measurement.lightingValue})]');
					/*[/]*/

					var lineChartData = {
						labels : labels,
						datasets : [ {
							label : 'Load Curve, Total : ' + tot,
							backgroundColor: '#65ecf1',
			                borderColor: '#65ecf1',
			                fill: false,
							data : loaddata
						},{
							label : 'Lighting Load, Total : ' + tot2,
							backgroundColor: '#f1de65',
			                borderColor: '#f1de65',
			                fill: false,
							data : lightingdata
						}]
					}

					var ctx = document.getElementById('line-chart-' + houseid)
							.getContext("2d");
					console.log(areaChartOptions);
					lines[houseid] = new Chart(ctx,  {
					    type: 'line',
					    data: lineChartData, 
					    options : areaChartOptions
					    });
					/*[/]*/

					var labels = [];
					var loaddata = [];
					var lightingdata = [];
					tot = 0;
					tot2 = 0;

					/*[# th:each="measure : ${houseTotal.resultLoadCurve.measurements}"]*/
						labels.push('[(${measure.time})]'.toHHMMSS());
						loaddata.push('[(${measure.value})]');
						tot = tot + parseInt('[(${measure.value})]');
						lightingdata.push('[(${measure.lightingValue})]');
						tot2 = tot2 + parseInt('[(${measure.lightingValue})]');
					/*[/]*/

					var lineChartData = {
						labels : labels,
						datasets : [ {
							label : 'Total Load Curve, Total : ' + tot,
							backgroundColor: '#1114b6',
			                borderColor: '#1114b6',
			                fill: false,
							data : loaddata
						},{
							label : 'Total Lighting Load, Total : ' + tot2,
							backgroundColor: '#f1de65',
			                borderColor: '#f1de65',
			                fill: false,
							data : lightingdata
						} ]

					}

					var ctx = document.getElementById('total-chart')
							.getContext("2d");
					var totChart = new Chart(ctx , {
					    type: 'line',
					    data: lineChartData, 
					    options : areaChartOptions
					    });
				});
		/*]]>*/
	</script>
</body>
</html>

